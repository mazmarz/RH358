---
- hosts: rh3
  become: true
  tasks:


  - name: take care of firewall
    firewalld:
      service: dns
      immediate: true
      state: enabled
      permanent: true

  - name: install dns
    yum:
      name: bind
      state: installed

  - name: copy over the required setup files
    copy:
      src: /home/devops/RH358/files/named.conf.template
      dest: /etc/named.conf
      group: named
      mode: '0640'
      setype: named_conf_t
    notify: restart named

  - name: add required zone file
    template:
      src: /home/devops/RH358/files/named.home.local.template
      dest: /var/named/named.home.local
      group: named
      mode: '0640'
      setype: named_zone_t
    notify: restart named

  - name: add required zone file
    template:
      src: /home/devops/RH358/files/named.home.reverse.template
      dest: /var/named/named.reverse.local
      group: named
      mode: '0640'
      setype: named_zone_t
    notify: restart named



  handlers:
  
  - name: restart named
    service:
      name: named
      state: restarted
      enabled: true

- hosts: bound
  become: true
  tags: unbound
  tasks:

  - name: first make sure it is installed
    yum:
      state: installed
      name: unbound

  - name: next copy of the template
    template:
      src: /home/devops/RH358/files/unbound.conf.template
      dest: /etc/unbound/unbound.conf
      mode: '0644'
      setype: named_conf_t
    notify: restart service
  
  - name: enable service
    service:
      name: unbound
      enabled: true
      state: started

  handlers:

  - name: restart service
    service:
      name: unbound
      state: restarted
